import {getOpenApiTestFile} from '../utils/files.util';
import {TestFileType} from "../types/testFile.type";
import {validateSchema} from "../utils/schema.util";
import {ErrorObject} from "ajv/lib/types";

export function validateCommandFunc(input: string): void {
    // Parse test cases (json)
    const tests: TestFileType = getOpenApiTestFile(input)

    const validate: { success: boolean, errors?: null | ErrorObject[] } = validateSchema(tests)

    if (!validate.success) {
        console.error("Validation failed: ", validate.errors);
        process.exit(1);
    }
}

export const validateCommandHandler = (options: { input: string }) => {
    validateCommandFunc(options.input)
    console.log(`"${options.input}" is a valid opentest file`);
};
